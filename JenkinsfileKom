pipeline {
    agent any
    environment {
        GITHUB_CREDENTIALS = credentials('github')
    }
    stages {
        stage('Konvert') {
            steps {
                sh '''
                mkdir -p k8s-manifests-j
                kompose convert -f docker-compose.yaml -o k8s-manifests-j/
                '''
            }
        }
        stage('Push') {
            steps {
                sh '''
                git config --global user.name "Jenkins"
                git config --global user.email "jenkins@yourdomain.com"
                git checkout main
                git add k8s-manifests-j/
                git commit -m "Auto-converted docker-compose to Kubernetes manifests" || echo "No changes to commit"
                git push origin main
                '''
            }
        }
    }
}
